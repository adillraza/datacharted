# DataCharted Domain Redirect Configuration
# File: /etc/nginx/sites-available/datacharted-redirect
# Purpose: Redirect all traffic from datacharted.com to app.datacharted.com

# HTTP Redirect (Port 80)
server {
    listen 80;
    listen [::]:80;
    server_name datacharted.com www.datacharted.com;
    
    # Log access for monitoring
    access_log /var/log/nginx/datacharted-redirect.access.log;
    error_log /var/log/nginx/datacharted-redirect.error.log;
    
    # Permanent redirect (301) to app.datacharted.com with HTTPS
    # This preserves the full URL path and query parameters
    return 301 https://app.datacharted.com$request_uri;
}

# HTTPS Redirect (Port 443) - Optional if you have SSL certificates
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name datacharted.com www.datacharted.com;
    
    # SSL Configuration - Update paths to your actual certificates
    # You can get free certificates with: certbot --nginx -d datacharted.com -d www.datacharted.com
    ssl_certificate /etc/letsencrypt/live/datacharted.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/datacharted.com/privkey.pem;
    
    # Modern SSL configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # Security headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    
    # Log access for monitoring
    access_log /var/log/nginx/datacharted-redirect-ssl.access.log;
    error_log /var/log/nginx/datacharted-redirect-ssl.error.log;
    
    # Permanent redirect (301) to app.datacharted.com
    # This preserves the full URL path and query parameters
    return 301 https://app.datacharted.com$request_uri;
}

# Optional: Handle specific legacy WordPress URLs if needed
# server {
#     listen 80;
#     server_name datacharted.com www.datacharted.com;
#     
#     # Redirect specific WordPress paths to appropriate app pages
#     location /wp-admin {
#         return 301 https://app.datacharted.com/auth/login;
#     }
#     
#     location /blog {
#         return 301 https://app.datacharted.com/;
#     }
#     
#     # Default redirect for all other paths
#     location / {
#         return 301 https://app.datacharted.com$request_uri;
#     }
# }
